{
    "$schema": "<relative path to createFormUI.schema.json>",
    "view": {
        "kind": "Form",
        "properties": {
            "title": "AVD Solution Accelerator Landing Zone",
            "steps": [
                {
                    "name": "basics",
                    "label": "AVD Solution Accelerator",
                    "elements": [
                        {
                            "name": "info",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "text": "The AVD Solution Accelerator provisions the foundational items required to build and run an Azure Virtual Desktop environment.",
                                "uri": "https://docs.microsoft.com/azure/role-based-access-control/elevate-access-global-admin",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "resourceScope",
                            "type": "Microsoft.Common.ResourceScope",
                            "location": {
                                "resourceTypes": []
                            }
                        }
                    ]
                },
                {
                    "name": "AVDLandingZone",
                    "label": "AVD Landing Zone",
                    "elements": [
						{
						"name": "workspaceSection",
						"type": "Microsoft.Common.Section",
						"label": "AVD Workspace",
                        "visible": true,
						"elements": [
                            {
                                "name": "workspaceName",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Workspace Name",
                                "defaultValue": "poc",
                                "toolTip": "",
                                "constraints": {
                                    "required": true,
                                    "regex": "",
                                    "validationMessage": ""
                                },
                                "visible": true
                            }
						]
						},
						{
						"name": "hostPoolSection",
						"type": "Microsoft.Common.Section",
						"label": "AVD Hostpool",
                        "visible": true,
						"elements": [
                            {
                                "name": "hostPoolName",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Host Pool Name",
                                "defaultValue": "",
                                "toolTip": "",
                                "constraints": {
                                    "required": true,
                                    "regex": "",
                                    "validationMessage": ""
                                },
                                "visible": true
                            },
                            {
                                "name": "hostPoolType",
                                "type": "Microsoft.Common.DropDown",
                                "label": "Host Pool Type",
                                "defaultValue": "Pooled",
                                "multiLine": true,
                                "toolTip": "",
                                "constraints": {
                                    "required": true,
                                    "allowedValues": [
                                        {
                                            "label": "Pooled",
                                            "description": "Multiple users per-VM",
                                            "value": "Pooled"
                                        },
                                        {
                                            "label": "Personal",
                                            "description": "Single user per-VM",
                                            "value": "Personal"
                                        }
                                    ]
                                },
                                "visible": true
                            },
                            {
                                "name": "loadBalancer",
                                "type": "Microsoft.Common.DropDown",
                                "label": "Load Balancer",
                                "defaultValue": "DepthFirst",
                                "multiLine": true,
                                "toolTip": "Breadth-first load balancing distributes new user sessions across all available session hosts in the host pool. Depth-first load balancing distributes new user sessions to an available session host with the highest number of connections but has not reached its maximum session limit threshold.",
                                "constraints": {
                                    "required": true,
                                    "allowedValues": [
                                        {
                                            "label": "BreadthFirst",
                                            "description": "Each new user is placed on the next VM. (Performance Optimized)",
                                            "value": "BreadthFirst"
                                        },
                                        {
                                            "label": "DepthFirst",
                                            "description": "Each new user is placed on the same VM until max sessions limit. (Cost Optimized)",
                                            "value": "DepthFirst"
                                        }
                                    ]
                                },
                                "visible": "[equals(steps('AVDLandingZone').hostPoolSection.hostPoolType, 'Pooled')]"
                            },
                            {
                                "name": "maxSessions",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Max Sessions",
                                "defaultValue": "4",
                                "toolTip": "The maximum number of users that have concurrent sessions on a session host. When setting a host pool to have depth first load balancing or planning to use Autoscaling, you must set an appropriate max session limit according to the configuration of your deployment and capacity of your VMs.",
                                "constraints": {
                                    "required": false,
                                    "regex": "",
                                    "validationMessage": ""
                                },
                                "visible": "[equals(steps('AVDLandingZone').hostPoolSection.hostPoolType, 'Pooled')]"
                            },
                            {
                                "name": "assignmentType",
                                "type": "Microsoft.Common.DropDown",
                                "label": "Machine Assignment",
                                "defaultValue": "Automatic",
                                "toolTip": "Automatic assignment – The service will select an available host and assign it to an user. Direct assignment – Admin selects a specific host to assign to an user.",
                                "constraints": {
                                    "required": true,
                                    "allowedValues": [
                                        {
                                            "label": "Automatic",
                                            "value": "Automatic"
                                        },
                                        {
                                            "label": "Direct",
                                            "value": "Direct"
                                        }
                                    ]
                                },
                                "visible": "[equals(steps('AVDLandingZone').hostPoolSection.hostPoolType, 'Personal')]"
                            },
                            {
                                "name": "startVmOnConnect",
                                "type": "Microsoft.Common.OptionsGroup",
                                "label": "Start On Connect",
                                "defaultValue": "Yes (Recommended)",
                                "toolTip": "If powered off, start VM once user connects. ",
                                "constraints": {
                                    "required": false,
                                    "allowedValues": [
                                        {
                                            "label": "Yes (Recommended)",
                                            "value": true
                                        },
                                        {
                                            "label": "No",
                                            "value": false
                                        }
                                    ]
                                },
                                "visible": true
                            },
                            {
                                "name": "createVmRole",
                                "type": "Microsoft.Common.OptionsGroup",
                                "label": "Create Start VM on Connect Role",
                                "defaultValue": "Yes (Required if using Start On Connect)",
                                "toolTip": "Create custom Azure IAM role for Start VM on Connect",
                                "constraints": {
                                    "required": false,
                                    "allowedValues": [
                                        {
                                            "label": "Yes (Required if using Start On Connect)",
                                            "value": true
                                        },
                                        {
                                            "label": "No",
                                            "value": false
                                        }
                                    ]
                                },
                                "visible": "[equals(steps('AVDLandingZone').hostPoolSection.startVmOnConnect, true)]"
                            }                            
                        ]
                        }
                    ]
                },
                {
                    "name": "AVDNetwork",
                    "label": "AVD Network",
                    "type": "Microsoft.Common.Section",
                    "visible": true,
                    "elements": [
						{
                            "name": "avdVNet",
                            "type": "Microsoft.Network.VirtualNetworkCombo",
                            "visible": true,
                            "label": {
                                "virtualNetwork": "Virtual network",
                                "subnets": "Subnets"
                            },
                            "toolTip": {
                                "virtualNetwork": "",
                                "subnets": ""
                            },
                            "defaultValue": {
                                "name": "vnet-avd",
                                "addressPrefixSize": "/24"
                            },
                            "constraints": {
                                "minAddressPrefixSize": "/27"
                            },
                            "options": {
                                "hideExisting": false
                            },
                            "subnets": {
                                "subnet1": {
                                "label": "Subnet",
                                "defaultValue": {
                                    "name": "subnet-avd",
                                    "addressPrefixSize": "/24"
                                },
                                "constraints": {
                                    "minAddressPrefixSize": "/27",
                                    "minAddressCount": 12,
                                    "requireContiguousAddresses": true
                                }
                                }
                            }
						},
                        {
                            "name": "createProfileStorage",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Create User Profile Storage",
                            "visible": true,
                            "defaultValue": "Yes (Recommended)",
                            "toolTip": "",
                            "constraints": {
                                "required": false,
                                "allowedValues": [
                                    {
                                        "label": "Yes (Recommended)",
                                        "value": true
                                    },
                                    {
                                        "label": "No",
                                        "value": false
                                    }
                                ]
                            }
                        },
						{
							"name": "fslogixStorage",
							"type": "Microsoft.Common.TextBox",
							"label": "Storage Account Name",
							"defaultValue": "fslpd",
							"toolTip": "File shares have a 15 character maximum, and must be globally unique. 6 Random characters will be appeneded to the name to ensure uniqueness.",
							"constraints": {
								"required": true,
								"regex": "^[a-z0-9A-Z]{1,9}$",
								"validationMessage": "Only alphanumeric characters are allowed, and the value must be 1-9 characters long."
							},
							"visible": "[equals(steps('AVDNetwork').createProfileStorage, true)]"
						},
						{
                           "name": "fileBackup",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Enable Azure Backup for User Profile Data",
                            "defaultValue": "Yes (Recommended)",
                            "toolTip": "",
                            "constraints": {
                                "required": true,
                                "allowedValues": [
                                    {
                                        "label": "Yes (Recommended)",
                                        "value": "true"
                                    },
                                    {
                                        "label": "No",
                                        "value": "false"
                                    }
                                ]
                            },
							"visible": "[equals(steps('AVDNetwork').createProfileStorage, true)]"
						}													
					]
                }								
            ]
        },
        "outputs": {
            "parameters": {
                "avdResourceGroup": "[steps('basics').resourceScope.resourceGroup.name]",
                "location": "[steps('basics').resourceScope.resourceGroup.location]",
                "workspaceName": "[steps('AVDLandingZone').workspaceSection.workspaceName]",
                "hostPoolName": "[steps('AVDLandingZone').hostPoolSection.hostPoolName]",
                "hostPoolType": "[steps('AVDLandingZone').hostPoolSection.hostPoolType]",
                "loadBalancer": "[steps('AVDLandingZone').hostPoolSection.loadBalancer]",
                "maxSessions": "[steps('AVDLandingZone').hostPoolSection.maxSessions]",
                "assignmentType": "[steps('AVDLandingZone').hostPoolSection.assignmentType]",
                "startVmOnConnect": "[steps('AVDLandingZone').hostPoolSection.startVmOnConnect]",
                "createVmRole": "[steps('AVDLandingZone').hostPoolSection.createVmRole]",
                "createProfileStorage": "[steps('AVDNetwork').createProfileStorage]",
                "avdVNet": "[steps('AVDNetwork').avdVNet]",
                "fslogixStorage": "[steps('AVDNetwork').fslogixStorage]",
                "fileBackup": "[steps('AVDNetwork').fileBackup]"
            },
            "kind": "ResourceGroup"
        }
    }
}
